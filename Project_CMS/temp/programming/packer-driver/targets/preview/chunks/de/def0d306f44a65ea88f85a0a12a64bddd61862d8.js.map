{"version":3,"sources":["file:///D:/CMSVTTV/Project_CMS/assets/Script/Game1-4.ts"],"names":["_decorator","Component","Node","Label","assetManager","SpriteFrame","Texture2D","find","Sprite","AudioSource","ccclass","property","Game1_4","nodeupload","nodeSave","start","uploadimg","UploadFile","event","namenode","target","uuid","console","log","cc","sys","isBrowser","ipFile","document","createElement","type","accept","click","addEventListener","img","canvas","reader","FileReader","onload","progressEvent","src","result","ctx","getContext","drawImage","MAX_WIDTH","MAX_HEIGHT","width","height","dataUrl","toDataURL","replace","fetch","then","res","arrayBuffer","buffer","files","readAsDataURL","myHeaders","Headers","append","formdata","FormData","name","requestOptions","method","headers","body","redirect","response","text","classItem","JSON","parse","url","setImage","popupupload","active","catch","error","OpenpopupUpload","node","newLocal","ClosepopupUpload","remoteUrl","typefile","substr","length","warn","loadRemote","err","imageAsset","spr","getComponent","spriteFrame","tex","image","texture","textlabel","string","enableSoundSprite","playSound","id","getChildByName","audioClip","clip","play"],"mappings":"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","sourcesContent":["import {\r\n    _decorator,\r\n    Component,\r\n    Node,\r\n    Prefab,\r\n    instantiate,\r\n    Label,\r\n    assetManager,\r\n    SpriteFrame,\r\n    Texture2D,\r\n    find,\r\n    Sprite,\r\n    AudioClip,\r\n    AudioSource,\r\n} from \"cc\";\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('Game1_4')\r\nexport class Game1_4 extends Component {\r\n    @property(Node)\r\n    popupupload: Node = null;\r\n\r\n    @property(SpriteFrame)\r\n    disableSoundSprite: SpriteFrame = null;\r\n\r\n    @property(SpriteFrame)\r\n    enableSoundSprite: SpriteFrame = null;\r\n\r\n    start() {\r\n\r\n    }\r\n\r\n    nodeupload = null; // node click upload\r\n    uploadimg() {\r\n        this.UploadFile(this.nodeupload);\r\n    }\r\n\r\n    //call từ bên item\r\n    UploadFile(event) {\r\n        var namenode = event.target.uuid;\r\n        console.log(event.target.uuid);\r\n        console.log(event.target);\r\n        this.nodeSave = event.target;\r\n        //   console.log(\"aaaaa\",find(\"Canvas\"))\r\n        if (cc.sys.isBrowser) {\r\n            let ipFile = document.createElement(\"input\");\r\n            ipFile.type = \"file\";\r\n            ipFile.accept = \"image/png/mp3\";\r\n            console.log(\"ipFile\", ipFile);\r\n            ipFile.click();\r\n            ipFile.addEventListener(\r\n                \"change\",\r\n                () => {\r\n                    var img = document.createElement(\"img\");\r\n                    var canvas = document.createElement(\"canvas\");\r\n                    var reader = new FileReader();\r\n                    reader.onload = function (progressEvent) {\r\n                        img.src = progressEvent.target.result;\r\n                        img.onload = function () {\r\n                            // access image size here\r\n                            var ctx = canvas.getContext(\"2d\");\r\n                            ctx.drawImage(img, 0, 0);\r\n\r\n                            var MAX_WIDTH = 800;\r\n                            var MAX_HEIGHT = 600;\r\n                            var width = img.width;\r\n                            var height = img.height;\r\n\r\n                            if (width > height) {\r\n                                if (width > MAX_WIDTH) {\r\n                                    height *= MAX_WIDTH / width;\r\n                                    width = MAX_WIDTH;\r\n                                }\r\n                            } else {\r\n                                if (height > MAX_HEIGHT) {\r\n                                    width *= MAX_HEIGHT / height;\r\n                                    height = MAX_HEIGHT;\r\n                                }\r\n                            }\r\n                            canvas.width = width;\r\n                            canvas.height = height;\r\n                            var ctx = canvas.getContext(\"2d\");\r\n                            ctx.drawImage(img, 0, 0, width, height);\r\n                            var dataUrl = canvas.toDataURL(\"image/png\");\r\n                            console.log(\"buffer\", dataUrl);\r\n                            dataUrl =\r\n                                \"data:application/octet-binary;base64,\" +\r\n                                dataUrl.replace(\"data:image/png;base64,\", \"\");\r\n                            fetch(dataUrl)\r\n                                .then((res) => res.arrayBuffer())\r\n                                .then((buffer) => {\r\n                                    console.log(\"buffer\", buffer);\r\n                                });\r\n                        };\r\n                    };\r\n                    console.log(\"ipFile.files[0]\", ipFile.files);\r\n                    reader.readAsDataURL(ipFile.files[0]);\r\n                    // call Api\r\n\r\n                    var myHeaders = new Headers();\r\n                    myHeaders.append(\r\n                        \"Cookie\",\r\n                        \".AspNetCore.Session=CfDJ8GmrYVI6VxlFp5hvVMclUtanrpD%2BHH0oRRUDw6oaMn3NwyayHlyo3pNzp%2BEoa5sTRFRu%2Fiycjkfhs3cCAhcMz%2FI7uzsM8IQhc14aMSSnuv8PAShbhhpB538WNIJQxIwHCpD%2BNRNl1pW04TW%2FgN9%2BD%2BQcZFNbTHkI7U%2BOu4E7BK59\"\r\n                    );\r\n\r\n                    var formdata = new FormData();\r\n                    formdata.append(\"Item\", ipFile.files[0], ipFile.files[0].name);\r\n                    formdata.append(\"ClassItem\", namenode);\r\n\r\n                    var requestOptions = {\r\n                        method: \"POST\",\r\n                        headers: myHeaders,\r\n                        body: formdata,\r\n                        redirect: \"follow\",\r\n                    };\r\n\r\n                    fetch(\"http://localhost:64457/Api/UploadFile\", requestOptions)\r\n                        .then((response) => response.text())\r\n                        .then((result) => {\r\n                            console.log(result);\r\n                            let classItem = JSON.parse(result).classItem;\r\n                            let url = JSON.parse(result).url;\r\n                            //   console.log(this.nodeSave.uuid);\r\n\r\n                            this.setImage(url);\r\n                            this.popupupload.active = false;\r\n                        })\r\n                        .catch((error) => console.log(\"error\", error));\r\n                },\r\n                false\r\n            );\r\n        }\r\n        this.popupupload.active = false;\r\n    }\r\n\r\n\r\n    public OpenpopupUpload(node) {\r\n        this.popupupload.active = true;\r\n\r\n        // this.popupupload.setSiblingIndex(100000);\r\n        const newLocal = this;\r\n        newLocal.nodeupload = node;\r\n        console.log(\"nodeupload =>\", this.nodeupload);\r\n        // if (this.nodeupload.name != \"question\") {\r\n        //   this.button_tpnl.active = false;\r\n        // }\r\n        // if (this.nodeupload.name == \"question\") {\r\n        //   if (\r\n        //     this.nodeupload.parent.getChildByName(\"iditem\").getComponent(Label)\r\n        //       .string != \"00000000-0000-0000-0000-000000000000\"\r\n        //   ) {\r\n        //     this.button_tpnl.active = true;\r\n        //   } else {\r\n        //     this.button_tpnl.active = false;\r\n        //   }\r\n    }\r\n\r\n    public ClosepopupUpload() {\r\n        this.popupupload.active = false;\r\n    }\r\n\r\n\r\n    nodeSave: Node = null;\r\n    setImage(remoteUrl) {\r\n        var typefile = remoteUrl.substr(remoteUrl.length - 3);\r\n        console.warn(\"typefile=>\", typefile);\r\n        if (typefile == \"png\" || typefile == \"jpg\") {\r\n            assetManager.loadRemote(remoteUrl, (err, imageAsset) => {\r\n                var spr = find(\"Img\", this.nodeSave);\r\n                console.log(spr);\r\n                console.log(spr.getComponent(Sprite));\r\n                console.log(\"spriteFrame\", spr.getComponent(Sprite).spriteFrame);\r\n                console.log(\"spriteFrame\", imageAsset);\r\n                const spriteFrame = new SpriteFrame();\r\n                const tex = new Texture2D();\r\n                tex.image = imageAsset;\r\n                spriteFrame.texture = tex;\r\n                spr.getComponent(Sprite).spriteFrame = spriteFrame;\r\n            });\r\n\r\n            var textlabel = find(\"Img/Label\", this.nodeSave);\r\n            textlabel.getComponent(Label).string = remoteUrl;\r\n            console.log(\"remoteUrl\", remoteUrl);\r\n            \r\n        }\r\n        if (typefile == \"mp3\") {\r\n            var textlabel = find(\"Sound/Label_sound\", this.nodeSave);\r\n            textlabel.getComponent(Label).string = remoteUrl;\r\n            find(\"Sound\", this.nodeSave).getComponent(Sprite).spriteFrame =\r\n                this.enableSoundSprite;\r\n        }\r\n    \r\n    }\r\n\r\n    playSound(event, id) {\r\n        console.log(id);\r\n        console.log(\r\n            event.target.getChildByName(\"Label_sound\").getComponent(Label).string\r\n        );\r\n        var url = event.target\r\n            .getChildByName(\"Label_sound\")\r\n            .getComponent(Label).string;\r\n        assetManager.loadRemote(url, (err, audioClip: AudioClip) => {\r\n            // this.node.getComponent(cc.AudioSource).clip.clear();\r\n            this.node.getComponent(AudioSource).clip = audioClip;\r\n            this.node.getComponent(AudioSource).play();\r\n        });\r\n    }\r\n}\r\n\r\n"]}