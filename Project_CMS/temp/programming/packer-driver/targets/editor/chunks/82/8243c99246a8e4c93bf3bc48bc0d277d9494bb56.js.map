{"version":3,"sources":["file:///D:/Project_CMS/NewProject/assets/Script/Game1-4.ts"],"names":["_decorator","Component","Node","assetManager","SpriteFrame","Texture2D","find","Sprite","ccclass","property","Game1_4","nodeupload","nodeSave","start","uploadimg","UploadFile","event","namenode","target","uuid","console","log","cc","sys","isBrowser","ipFile","document","createElement","type","accept","click","addEventListener","img","canvas","reader","FileReader","onload","progressEvent","src","result","ctx","getContext","drawImage","MAX_WIDTH","MAX_HEIGHT","width","height","dataUrl","toDataURL","replace","fetch","then","res","arrayBuffer","buffer","files","readAsDataURL","myHeaders","Headers","append","formdata","FormData","name","requestOptions","method","headers","body","redirect","response","text","classItem","JSON","parse","url","setImage","popupupload","active","catch","error","OpenpopupUpload","node","newLocal","ClosepopupUpload","remoteUrl","loadRemote","err","imageAsset","spr","getComponent","spriteFrame","tex","image","texture"],"mappings":";;;;;;;;;;;;;;AACIA,MAAAA,U,OAAAA,U;AACAC,MAAAA,S,OAAAA,S;AACAC,MAAAA,I,OAAAA,I;AAIAC,MAAAA,Y,OAAAA,Y;AACAC,MAAAA,W,OAAAA,W;AACAC,MAAAA,S,OAAAA,S;AACAC,MAAAA,I,OAAAA,I;AACAC,MAAAA,M,OAAAA,M;;;;;;;OAEE;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBT,U;;yBAGjBU,O,WADZF,OAAO,CAAC,SAAD,C,UAEHC,QAAQ,CAACP,IAAD,C,UAGRO,QAAQ,CAACL,WAAD,C,UAGRK,QAAQ,CAACL,WAAD,C,2BARb,MACaM,OADb,SAC6BT,SAD7B,CACuC;AAAA;AAAA;;AAAA;;AAAA;;AAAA;;AAAA,eAcnCU,UAdmC,GActB,IAdsB;AAAA,eA+InCC,QA/ImC,GA+IlB,IA/IkB;AAAA;;AAUnCC,QAAAA,KAAK,GAAG,CAEP;;AAEkB;AACnBC,QAAAA,SAAS,GAAG;AACR,eAAKC,UAAL,CAAgB,KAAKJ,UAArB;AACH,SAjBkC,CAmBnC;;;AACAI,QAAAA,UAAU,CAACC,KAAD,EAAQ;AACd,cAAIC,QAAQ,GAAGD,KAAK,CAACE,MAAN,CAAaC,IAA5B;AACAC,UAAAA,OAAO,CAACC,GAAR,CAAYL,KAAK,CAACE,MAAN,CAAaC,IAAzB;AACAC,UAAAA,OAAO,CAACC,GAAR,CAAYL,KAAK,CAACE,MAAlB;AACA,eAAKN,QAAL,GAAgBI,KAAK,CAACE,MAAtB,CAJc,CAKd;;AACA,cAAII,EAAE,CAACC,GAAH,CAAOC,SAAX,EAAsB;AACpB,gBAAIC,MAAM,GAAGC,QAAQ,CAACC,aAAT,CAAuB,OAAvB,CAAb;AACAF,YAAAA,MAAM,CAACG,IAAP,GAAc,MAAd;AACAH,YAAAA,MAAM,CAACI,MAAP,GAAgB,WAAhB;AACAT,YAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ,EAAsBI,MAAtB;AACAA,YAAAA,MAAM,CAACK,KAAP;AACAL,YAAAA,MAAM,CAACM,gBAAP,CACE,QADF,EAEE,MAAM;AACJ,kBAAIC,GAAG,GAAGN,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAV;AACA,kBAAIM,MAAM,GAAGP,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAb;AACA,kBAAIO,MAAM,GAAG,IAAIC,UAAJ,EAAb;;AACAD,cAAAA,MAAM,CAACE,MAAP,GAAgB,UAAUC,aAAV,EAAyB;AACvCL,gBAAAA,GAAG,CAACM,GAAJ,GAAUD,aAAa,CAACnB,MAAd,CAAqBqB,MAA/B;;AACAP,gBAAAA,GAAG,CAACI,MAAJ,GAAa,YAAY;AACvB;AACA,sBAAII,GAAG,GAAGP,MAAM,CAACQ,UAAP,CAAkB,IAAlB,CAAV;AACAD,kBAAAA,GAAG,CAACE,SAAJ,CAAcV,GAAd,EAAmB,CAAnB,EAAsB,CAAtB;AAEA,sBAAIW,SAAS,GAAG,GAAhB;AACA,sBAAIC,UAAU,GAAG,GAAjB;AACA,sBAAIC,KAAK,GAAGb,GAAG,CAACa,KAAhB;AACA,sBAAIC,MAAM,GAAGd,GAAG,CAACc,MAAjB;;AAEA,sBAAID,KAAK,GAAGC,MAAZ,EAAoB;AAClB,wBAAID,KAAK,GAAGF,SAAZ,EAAuB;AACrBG,sBAAAA,MAAM,IAAIH,SAAS,GAAGE,KAAtB;AACAA,sBAAAA,KAAK,GAAGF,SAAR;AACD;AACF,mBALD,MAKO;AACL,wBAAIG,MAAM,GAAGF,UAAb,EAAyB;AACvBC,sBAAAA,KAAK,IAAID,UAAU,GAAGE,MAAtB;AACAA,sBAAAA,MAAM,GAAGF,UAAT;AACD;AACF;;AACDX,kBAAAA,MAAM,CAACY,KAAP,GAAeA,KAAf;AACAZ,kBAAAA,MAAM,CAACa,MAAP,GAAgBA,MAAhB;AACA,sBAAIN,GAAG,GAAGP,MAAM,CAACQ,UAAP,CAAkB,IAAlB,CAAV;AACAD,kBAAAA,GAAG,CAACE,SAAJ,CAAcV,GAAd,EAAmB,CAAnB,EAAsB,CAAtB,EAAyBa,KAAzB,EAAgCC,MAAhC;AACA,sBAAIC,OAAO,GAAGd,MAAM,CAACe,SAAP,CAAiB,WAAjB,CAAd;AACA5B,kBAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ,EAAsB0B,OAAtB;AACAA,kBAAAA,OAAO,GACL,0CACAA,OAAO,CAACE,OAAR,CAAgB,wBAAhB,EAA0C,EAA1C,CAFF;AAGAC,kBAAAA,KAAK,CAACH,OAAD,CAAL,CACGI,IADH,CACSC,GAAD,IAASA,GAAG,CAACC,WAAJ,EADjB,EAEGF,IAFH,CAESG,MAAD,IAAY;AAChBlC,oBAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ,EAAsBiC,MAAtB;AACD,mBAJH;AAKD,iBAnCD;AAoCD,eAtCD;;AAuCAlC,cAAAA,OAAO,CAACC,GAAR,CAAY,iBAAZ,EAA+BI,MAAM,CAAC8B,KAAtC;AACArB,cAAAA,MAAM,CAACsB,aAAP,CAAqB/B,MAAM,CAAC8B,KAAP,CAAa,CAAb,CAArB,EA5CI,CA6CJ;;AAEA,kBAAIE,SAAS,GAAG,IAAIC,OAAJ,EAAhB;AACAD,cAAAA,SAAS,CAACE,MAAV,CACE,QADF,EAEE,wNAFF;AAKA,kBAAIC,QAAQ,GAAG,IAAIC,QAAJ,EAAf;AACAD,cAAAA,QAAQ,CAACD,MAAT,CAAgB,MAAhB,EAAwBlC,MAAM,CAAC8B,KAAP,CAAa,CAAb,CAAxB,EAAyC9B,MAAM,CAAC8B,KAAP,CAAa,CAAb,EAAgBO,IAAzD;AACAF,cAAAA,QAAQ,CAACD,MAAT,CAAgB,WAAhB,EAA6B1C,QAA7B;AAEA,kBAAI8C,cAAc,GAAG;AACnBC,gBAAAA,MAAM,EAAE,MADW;AAEnBC,gBAAAA,OAAO,EAAER,SAFU;AAGnBS,gBAAAA,IAAI,EAAEN,QAHa;AAInBO,gBAAAA,QAAQ,EAAE;AAJS,eAArB;AAOAjB,cAAAA,KAAK,CAAC,uCAAD,EAA0Ca,cAA1C,CAAL,CACGZ,IADH,CACSiB,QAAD,IAAcA,QAAQ,CAACC,IAAT,EADtB,EAEGlB,IAFH,CAESZ,MAAD,IAAY;AAChBnB,gBAAAA,OAAO,CAACC,GAAR,CAAYkB,MAAZ;AACA,oBAAI+B,SAAS,GAAGC,IAAI,CAACC,KAAL,CAAWjC,MAAX,EAAmB+B,SAAnC;AACA,oBAAIG,GAAG,GAAGF,IAAI,CAACC,KAAL,CAAWjC,MAAX,EAAmBkC,GAA7B,CAHgB,CAIlB;;AAEE,qBAAKC,QAAL,CAAcD,GAAd;AACA,qBAAKE,WAAL,CAAiBC,MAAjB,GAA0B,KAA1B;AACD,eAVH,EAWGC,KAXH,CAWUC,KAAD,IAAW1D,OAAO,CAACC,GAAR,CAAY,OAAZ,EAAqByD,KAArB,CAXpB;AAYD,aA9EH,EA+EE,KA/EF;AAiFD;AACF;;AAGIC,QAAAA,eAAe,CAACC,IAAD,EAAO;AACzB,eAAKL,WAAL,CAAiBC,MAAjB,GAA0B,IAA1B,CADyB,CAGzB;;AACA,gBAAMK,QAAQ,GAAG,IAAjB;AACAA,UAAAA,QAAQ,CAACtE,UAAT,GAAsBqE,IAAtB;AACA5D,UAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ,EAA6B,KAAKV,UAAlC,EANyB,CAOzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACH;;AAEMuE,QAAAA,gBAAgB,GAAG;AACtB,eAAKP,WAAL,CAAiBC,MAAjB,GAA0B,KAA1B;AACH;;AAIDF,QAAAA,QAAQ,CAACS,SAAD,EAAY;AAChBhF,UAAAA,YAAY,CAACiF,UAAb,CAAwBD,SAAxB,EAAmC,CAACE,GAAD,EAAMC,UAAN,KAAqB;AACtD,gBAAIC,GAAG,GAAGjF,IAAI,CAAC,KAAD,EAAQ,KAAKM,QAAb,CAAd;AACAQ,YAAAA,OAAO,CAACC,GAAR,CAAYkE,GAAZ;AACAnE,YAAAA,OAAO,CAACC,GAAR,CAAYkE,GAAG,CAACC,YAAJ,CAAiBjF,MAAjB,CAAZ;AACAa,YAAAA,OAAO,CAACC,GAAR,CAAY,aAAZ,EAA2BkE,GAAG,CAACC,YAAJ,CAAiBjF,MAAjB,EAAyBkF,WAApD;AACArE,YAAAA,OAAO,CAACC,GAAR,CAAY,aAAZ,EAA2BiE,UAA3B;AACA,kBAAMG,WAAW,GAAG,IAAIrF,WAAJ,EAApB;AACA,kBAAMsF,GAAG,GAAG,IAAIrF,SAAJ,EAAZ;AACAqF,YAAAA,GAAG,CAACC,KAAJ,GAAYL,UAAZ;AACAG,YAAAA,WAAW,CAACG,OAAZ,GAAsBF,GAAtB;AACAH,YAAAA,GAAG,CAACC,YAAJ,CAAiBjF,MAAjB,EAAyBkF,WAAzB,GAAuCA,WAAvC;AACD,WAXD,EADgB,CAchB;AACA;AACD;;AAhKgC,O;;;;;iBAEf,I;;;;;;;iBAGc,I;;;;;;;iBAGD,I","sourcesContent":["import {\n    _decorator,\n    Component,\n    Node,\n    Prefab,\n    instantiate,\n    Label,\n    assetManager,\n    SpriteFrame,\n    Texture2D,\n    find,\n    Sprite,\n} from \"cc\";\nconst { ccclass, property } = _decorator;\n\n@ccclass('Game1_4')\nexport class Game1_4 extends Component {\n    @property(Node)\n    popupupload: Node = null;\n\n    @property(SpriteFrame)\n    disableSoundSprite: SpriteFrame = null;\n\n    @property(SpriteFrame)\n    enableSoundSprite: SpriteFrame = null;\n\n    start() {\n\n    }\n\n    nodeupload = null; // node click upload\n    uploadimg() {\n        this.UploadFile(this.nodeupload);\n    }\n\n    //call từ bên item\n    UploadFile(event) {\n        var namenode = event.target.uuid;\n        console.log(event.target.uuid);\n        console.log(event.target);\n        this.nodeSave = event.target;\n        //   console.log(\"aaaaa\",find(\"Canvas\"))\n        if (cc.sys.isBrowser) {\n          let ipFile = document.createElement(\"input\");\n          ipFile.type = \"file\";\n          ipFile.accept = \"image/png\";\n          console.log(\"ipFile\", ipFile);\n          ipFile.click();\n          ipFile.addEventListener(\n            \"change\",\n            () => {\n              var img = document.createElement(\"img\");\n              var canvas = document.createElement(\"canvas\");\n              var reader = new FileReader();\n              reader.onload = function (progressEvent) {\n                img.src = progressEvent.target.result;\n                img.onload = function () {\n                  // access image size here\n                  var ctx = canvas.getContext(\"2d\");\n                  ctx.drawImage(img, 0, 0);\n    \n                  var MAX_WIDTH = 800;\n                  var MAX_HEIGHT = 600;\n                  var width = img.width;\n                  var height = img.height;\n    \n                  if (width > height) {\n                    if (width > MAX_WIDTH) {\n                      height *= MAX_WIDTH / width;\n                      width = MAX_WIDTH;\n                    }\n                  } else {\n                    if (height > MAX_HEIGHT) {\n                      width *= MAX_HEIGHT / height;\n                      height = MAX_HEIGHT;\n                    }\n                  }\n                  canvas.width = width;\n                  canvas.height = height;\n                  var ctx = canvas.getContext(\"2d\");\n                  ctx.drawImage(img, 0, 0, width, height);\n                  var dataUrl = canvas.toDataURL(\"image/png\");\n                  console.log(\"buffer\", dataUrl);\n                  dataUrl =\n                    \"data:application/octet-binary;base64,\" +\n                    dataUrl.replace(\"data:image/png;base64,\", \"\");\n                  fetch(dataUrl)\n                    .then((res) => res.arrayBuffer())\n                    .then((buffer) => {\n                      console.log(\"buffer\", buffer);\n                    });\n                };\n              };\n              console.log(\"ipFile.files[0]\", ipFile.files);\n              reader.readAsDataURL(ipFile.files[0]);\n              // call Api\n    \n              var myHeaders = new Headers();\n              myHeaders.append(\n                \"Cookie\",\n                \".AspNetCore.Session=CfDJ8GmrYVI6VxlFp5hvVMclUtanrpD%2BHH0oRRUDw6oaMn3NwyayHlyo3pNzp%2BEoa5sTRFRu%2Fiycjkfhs3cCAhcMz%2FI7uzsM8IQhc14aMSSnuv8PAShbhhpB538WNIJQxIwHCpD%2BNRNl1pW04TW%2FgN9%2BD%2BQcZFNbTHkI7U%2BOu4E7BK59\"\n              );\n    \n              var formdata = new FormData();\n              formdata.append(\"Item\", ipFile.files[0], ipFile.files[0].name);\n              formdata.append(\"ClassItem\", namenode);\n    \n              var requestOptions = {\n                method: \"POST\",\n                headers: myHeaders,\n                body: formdata,\n                redirect: \"follow\",\n              };\n    \n              fetch(\"http://localhost:64457/Api/UploadFile\", requestOptions)\n                .then((response) => response.text())\n                .then((result) => {\n                  console.log(result);\n                  let classItem = JSON.parse(result).classItem;\n                  let url = JSON.parse(result).url;\n                //   console.log(this.nodeSave.uuid);\n    \n                  this.setImage(url);\n                  this.popupupload.active = false;\n                })\n                .catch((error) => console.log(\"error\", error));\n            },\n            false\n          );\n        }\n      }\n    \n\n    public OpenpopupUpload(node) {\n        this.popupupload.active = true;\n\n        // this.popupupload.setSiblingIndex(100000);\n        const newLocal = this;\n        newLocal.nodeupload = node;\n        console.log(\"nodeupload =>\", this.nodeupload);\n        // if (this.nodeupload.name != \"question\") {\n        //   this.button_tpnl.active = false;\n        // }\n        // if (this.nodeupload.name == \"question\") {\n        //   if (\n        //     this.nodeupload.parent.getChildByName(\"iditem\").getComponent(Label)\n        //       .string != \"00000000-0000-0000-0000-000000000000\"\n        //   ) {\n        //     this.button_tpnl.active = true;\n        //   } else {\n        //     this.button_tpnl.active = false;\n        //   }\n    }\n\n    public ClosepopupUpload() {\n        this.popupupload.active = false;\n    }\n\n\n    nodeSave: Node = null;\n    setImage(remoteUrl) {\n        assetManager.loadRemote(remoteUrl, (err, imageAsset) => {\n          var spr = find(\"Img\", this.nodeSave);\n          console.log(spr);\n          console.log(spr.getComponent(Sprite));\n          console.log(\"spriteFrame\", spr.getComponent(Sprite).spriteFrame);\n          console.log(\"spriteFrame\", imageAsset);\n          const spriteFrame = new SpriteFrame();\n          const tex = new Texture2D();\n          tex.image = imageAsset;\n          spriteFrame.texture = tex;\n          spr.getComponent(Sprite).spriteFrame = spriteFrame;\n        });\n    \n        // var textlabel = find(\"Mask/Sprite/Label_sprite\", this.nodeSave);\n        // textlabel.getComponent(Label).string = remoteUrl;\n      }\n}\n\n"]}