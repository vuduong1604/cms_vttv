{"version":3,"sources":["file:///D:/CMS/cms_vttv-main/Project_CMS/assets/Script/Game1-4.ts"],"names":["_decorator","Component","Node","Label","assetManager","SpriteFrame","Texture2D","find","Sprite","AudioSource","ccclass","property","Game1_4","nodeupload","nodeSave","start","uploadimg","UploadFile","event","namenode","target","uuid","console","log","cc","sys","isBrowser","ipFile","document","createElement","type","accept","click","addEventListener","img","canvas","reader","FileReader","onload","progressEvent","src","result","ctx","getContext","drawImage","MAX_WIDTH","MAX_HEIGHT","width","height","dataUrl","toDataURL","replace","fetch","then","res","arrayBuffer","buffer","files","readAsDataURL","myHeaders","Headers","append","formdata","FormData","name","requestOptions","method","headers","body","redirect","response","text","classItem","JSON","parse","url","setImage","popupupload","active","catch","error","OpenpopupUpload","node","newLocal","ClosepopupUpload","remoteUrl","typefile","substr","length","warn","loadRemote","err","imageAsset","spr","getComponent","spriteFrame","tex","image","texture","textlabel","string","enableSoundSprite","playSound","id","getChildByName","audioClip","clip","play"],"mappings":"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","sourcesContent":["import {\n    _decorator,\n    Component,\n    Node,\n    Prefab,\n    instantiate,\n    Label,\n    assetManager,\n    SpriteFrame,\n    Texture2D,\n    find,\n    Sprite,\n    AudioClip,\n    AudioSource,\n} from \"cc\";\nconst { ccclass, property } = _decorator;\n\n@ccclass('Game1_4')\nexport class Game1_4 extends Component {\n    @property(Node)\n    popupupload: Node = null;\n\n    @property(SpriteFrame)\n    disableSoundSprite: SpriteFrame = null;\n\n    @property(Node)\n    enableSoundSprite: Node = null;\n\n    start() {\n\n    }\n\n    nodeupload = null; // node click upload\n    uploadimg() {\n        this.UploadFile(this.nodeupload);\n\n    }\n\n    //call từ bên item\n    UploadFile(event) {\n        var namenode = event.target.uuid;\n        console.log(event.target.uuid);\n        console.log(event.target);\n        this.nodeSave = event.target;\n        //   console.log(\"aaaaa\",find(\"Canvas\"))\n        if (cc.sys.isBrowser) {\n            let ipFile = document.createElement(\"input\");\n            ipFile.type = \"file\";\n            ipFile.accept = \"image/png/mp3\";\n            console.log(\"ipFile\", ipFile);\n            ipFile.click();\n            ipFile.addEventListener(\n                \"change\",\n                () => {\n                    var img = document.createElement(\"img\");\n                    var canvas = document.createElement(\"canvas\");\n                    var reader = new FileReader();\n                    reader.onload = function (progressEvent) {\n                        img.src = progressEvent.target.result;\n                        img.onload = function () {\n                            // access image size here\n                            var ctx = canvas.getContext(\"2d\");\n                            ctx.drawImage(img, 0, 0);\n\n                            var MAX_WIDTH = 800;\n                            var MAX_HEIGHT = 600;\n                            var width = img.width;\n                            var height = img.height;\n\n                            if (width > height) {\n                                if (width > MAX_WIDTH) {\n                                    height *= MAX_WIDTH / width;\n                                    width = MAX_WIDTH;\n                                }\n                            } else {\n                                if (height > MAX_HEIGHT) {\n                                    width *= MAX_HEIGHT / height;\n                                    height = MAX_HEIGHT;\n                                }\n                            }\n                            canvas.width = width;\n                            canvas.height = height;\n                            var ctx = canvas.getContext(\"2d\");\n                            ctx.drawImage(img, 0, 0, width, height);\n                            var dataUrl = canvas.toDataURL(\"image/png\");\n                            console.log(\"buffer\", dataUrl);\n                            dataUrl =\n                                \"data:application/octet-binary;base64,\" +\n                                dataUrl.replace(\"data:image/png;base64,\", \"\");\n                            fetch(dataUrl)\n                                .then((res) => res.arrayBuffer())\n                                .then((buffer) => {\n                                    console.log(\"buffer\", buffer);\n                                });\n                        };\n                    };\n                    console.log(\"ipFile.files[0]\", ipFile.files);\n                    reader.readAsDataURL(ipFile.files[0]);\n                    // call Api\n\n                    var myHeaders = new Headers();\n                    myHeaders.append(\n                        \"Cookie\",\n                        \".AspNetCore.Session=CfDJ8GmrYVI6VxlFp5hvVMclUtanrpD%2BHH0oRRUDw6oaMn3NwyayHlyo3pNzp%2BEoa5sTRFRu%2Fiycjkfhs3cCAhcMz%2FI7uzsM8IQhc14aMSSnuv8PAShbhhpB538WNIJQxIwHCpD%2BNRNl1pW04TW%2FgN9%2BD%2BQcZFNbTHkI7U%2BOu4E7BK59\"\n                    );\n\n                    var formdata = new FormData();\n                    formdata.append(\"Item\", ipFile.files[0], ipFile.files[0].name);\n                    formdata.append(\"ClassItem\", namenode);\n\n                    var requestOptions = {\n                        method: \"POST\",\n                        headers: myHeaders,\n                        body: formdata,\n                        redirect: \"follow\",\n                    };\n\n                    fetch(\"http://localhost:64457/Api/UploadFile\", requestOptions)\n                        .then((response) => response.text())\n                        .then((result) => {\n                            console.log(result);\n                            let classItem = JSON.parse(result).classItem;\n                            let url = JSON.parse(result).url;\n                            //   console.log(this.nodeSave.uuid);\n\n                            this.setImage(url);\n                            this.popupupload.active = false;\n                        })\n                        .catch((error) => console.log(\"error\", error));\n                },\n                false\n            );\n        }\n        this.popupupload.active = false;\n  \n    }\n\n\n    public OpenpopupUpload(node) {\n        this.popupupload.active = true;\n\n        // this.popupupload.setSiblingIndex(100000);\n        const newLocal = this;\n        newLocal.nodeupload = node;\n        console.log(\"nodeupload =>\", this.nodeupload);\n        // if (this.nodeupload.name != \"question\") {\n        //   this.button_tpnl.active = false;\n        // }\n        // if (this.nodeupload.name == \"question\") {\n        //   if (\n        //     this.nodeupload.parent.getChildByName(\"iditem\").getComponent(Label)\n        //       .string != \"00000000-0000-0000-0000-000000000000\"\n        //   ) {\n        //     this.button_tpnl.active = true;\n        //   } else {\n        //     this.button_tpnl.active = false;\n        //   }\n    }\n\n    public ClosepopupUpload() {\n        this.popupupload.active = false;\n    }\n\n\n    nodeSave: Node = null;\n    setImage(remoteUrl) {\n        var typefile = remoteUrl.substr(remoteUrl.length - 3);\n        console.warn(\"typefile=>\", typefile);\n        if (typefile == \"png\" || typefile == \"jpg\") {\n            assetManager.loadRemote(remoteUrl, (err, imageAsset) => {\n                var spr = find(\"Img\", this.nodeSave);\n                console.log(spr);\n                console.log(spr.getComponent(Sprite));\n                console.log(\"spriteFrame\", spr.getComponent(Sprite).spriteFrame);\n                console.log(\"spriteFrame\", imageAsset);\n                const spriteFrame = new SpriteFrame();\n                const tex = new Texture2D();\n                tex.image = imageAsset;\n                spriteFrame.texture = tex;\n                spr.getComponent(Sprite).spriteFrame = spriteFrame;\n            });\n\n            var textlabel = find(\"Img/Label\", this.nodeSave);\n            textlabel.getComponent(Label).string = remoteUrl;\n            console.log(\"remoteUrl\", remoteUrl);\n            \n        }\n        if (typefile == \"mp3\") {\n            var textlabel = find(\"sound/Label_sound\", this.nodeSave);\n            textlabel.getComponent(Label).string = remoteUrl;\n            this.enableSoundSprite.active = true;\n            // find(\"Sound\", this.nodeSave).getComponent(Sprite).spriteFrame =\n            //     this.enableSoundSprite;\n                \n        }\n    \n    }\n\n    playSound(event, id) {\n        console.log(id);\n        console.log(\n            event.target.getChildByName(\"Label_sound\").getComponent(Label).string\n        );\n        var url = event.target\n            .getChildByName(\"Label_sound\")\n            .getComponent(Label).string;\n        assetManager.loadRemote(url, (err, audioClip: AudioClip) => {\n            // this.node.getComponent(cc.AudioSource).clip.clear();\n            this.node.getComponent(AudioSource).clip = audioClip;\n            this.node.getComponent(AudioSource).play();\n        });\n    }\n}\n\n"]}